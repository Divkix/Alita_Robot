---
phase: 03-locale-and-i18n-fixes
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - locales/es.yml
  - locales/fr.yml
  - locales/hi.yml
autonomous: true
requirements: [I18N-02, I18N-04, I18N-05, I18N-06]

must_haves:
  truths:
    - "ES locale has zero orphan keys (no keys that exist in ES but not EN)"
    - "FR locale has all production keys that EN has"
    - "HI locale has all production keys that EN has"
    - "`make check-translations` exits 0 with zero errors across all four locales"
  artifacts:
    - path: "locales/es.yml"
      provides: "ES locale with 7 orphan keys removed and 7 old keys removed"
    - path: "locales/fr.yml"
      provides: "FR locale with 10 new production keys added and 7 old keys removed"
    - path: "locales/hi.yml"
      provides: "HI locale with 10 new production keys added and 7 old keys removed"
  key_links:
    - from: "locales/en.yml"
      to: "locales/es.yml"
      via: "ES must be subset of EN keys (no orphans)"
      pattern: "set(es_keys) - set(en_keys) == empty"
    - from: "locales/en.yml"
      to: "locales/fr.yml"
      via: "FR must contain all EN keys"
      pattern: "set(en_keys) - set(fr_keys) == empty"
    - from: "locales/en.yml"
      to: "locales/hi.yml"
      via: "HI must contain all EN keys"
      pattern: "set(en_keys) - set(hi_keys) == empty"
---

<objective>
Propagate the 10 new production keys from EN to ES/FR/HI locales, remove 7 ES-only orphan keys, remove 7 old-named keys from all three locales, and verify `make check-translations` passes clean with zero errors.

Purpose: After plan 03-01 fixes EN and the script, this plan brings the remaining three locales into alignment. ES has 7 orphan keys (4 old devs names + 3 dead misc_translate keys) and 7 old-named keys. FR and HI each need 10 new keys added and 7 old keys removed. Once complete, all four locales pass the automated check.

Output: All four locale files are internally consistent, cross-locale aligned, and `make check-translations` exits 0.
</objective>

<execution_context>
@/Users/divkix/.claude/get-shit-done/workflows/execute-plan.md
@/Users/divkix/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-locale-and-i18n-fixes/03-RESEARCH.md

Key reference — what each locale needs:

**ES locale (locales/es.yml — currently 842 keys):**
- ES already HAS the 4 correct devs code-facing keys (devs_getting_chat_list, devs_chat_list_caption, devs_no_team_users, devs_no_users) — they stay
- ES already HAS the 3 greetings _button suffixed keys — needs _btn variants added
- ES is MISSING 3 genuinely new keys: bans_cannot_identify_user, captcha_internal_error, reports_cannot_report_channel
- REMOVE 4 old devs keys: devs_getting_chatlist, devs_chatlist_caption, devs_no_team_members, devs_no_users_in_category
- REMOVE 3 dead misc_translate keys: misc_translate_need_text, misc_translate_no_text, misc_translate_provide_text
- REMOVE 3 old greetings _button keys after adding _btn variants
- Target: 842 - 10 removed + 6 added = 838 keys

**FR locale (locales/fr.yml — currently 835 keys):**
- NEEDS all 10 new production keys added
- For the 4 devs renames: copy value from existing FR old key name
- For the 3 greetings renames: copy value from existing FR _button key
- For 3 genuinely new keys: use EN value as placeholder (i18n system would fall back to EN anyway)
- REMOVE 7 old keys (4 devs + 3 greetings _button)
- Target: 835 + 10 added - 7 removed = 838 keys

**HI locale (locales/hi.yml — currently 835 keys):**
- Identical treatment to FR
- Target: 835 + 10 added - 7 removed = 838 keys
</context>

<tasks>

<task type="auto">
  <name>Task 1: Propagate new keys to ES/FR/HI and remove orphan/old keys from ES</name>
  <files>locales/es.yml, locales/fr.yml, locales/hi.yml</files>
  <action>
**ES locale (locales/es.yml):**

ADD these 6 keys (ES is missing these — the other 4 new devs keys already exist in ES):
- `greetings_join_request_approve_btn: "✅ Aprobar"` (translated version of the _button variant already in ES)
- `greetings_join_request_decline_btn: "❌ Rechazar"` (translated version of the _button variant already in ES)
- `greetings_join_request_ban_btn: "✅ Banear"` (translated version of the _button variant already in ES)
- `bans_cannot_identify_user: "No se puede identificar al usuario del mensaje respondido."` (translate from EN)
- `captcha_internal_error: "Ocurrió un error interno al actualizar la configuración de captcha. Por favor, inténtelo de nuevo."` (translate from EN)
- `reports_cannot_report_channel: "No puedes reportar una publicación de canal."` (translate from EN)

REMOVE these 10 keys from ES:
- `devs_getting_chatlist` (old devs name — ES has both old and new)
- `devs_chatlist_caption` (old devs name)
- `devs_no_team_members` (old devs name)
- `devs_no_users_in_category` (old devs name)
- `misc_translate_need_text` (dead, no code reference)
- `misc_translate_no_text` (dead, no code reference)
- `misc_translate_provide_text` (dead, no code reference)
- `greetings_join_request_approve_button` (old _button suffix)
- `greetings_join_request_decline_button` (old _button suffix)
- `greetings_join_request_ban_button` (old _button suffix)

ES target: 842 - 10 + 6 = 838 keys

**FR locale (locales/fr.yml):**

ADD these 10 keys:
- `devs_getting_chat_list:` — copy value from existing FR key `devs_getting_chatlist`
- `devs_chat_list_caption:` — copy value from existing FR key `devs_chatlist_caption`
- `devs_no_team_users:` — copy value from existing FR key `devs_no_team_members`
- `devs_no_users:` — copy value from existing FR key `devs_no_users_in_category`
- `greetings_join_request_approve_btn:` — copy value from existing FR key `greetings_join_request_approve_button`
- `greetings_join_request_decline_btn:` — copy value from existing FR key `greetings_join_request_decline_button`
- `greetings_join_request_ban_btn:` — copy value from existing FR key `greetings_join_request_ban_button`
- `bans_cannot_identify_user: "Impossible d'identifier l'utilisateur à partir du message cité."` (translate from EN)
- `captcha_internal_error: "Une erreur interne s'est produite lors de la mise à jour des paramètres du captcha. Veuillez réessayer."` (translate from EN)
- `reports_cannot_report_channel: "Vous ne pouvez pas signaler une publication de chaîne."` (translate from EN)

REMOVE these 7 old keys from FR:
- `devs_getting_chatlist`
- `devs_chatlist_caption`
- `devs_no_team_members`
- `devs_no_users_in_category`
- `greetings_join_request_approve_button`
- `greetings_join_request_decline_button`
- `greetings_join_request_ban_button`

FR target: 835 + 10 - 7 = 838 keys

**HI locale (locales/hi.yml):**

ADD these 10 keys:
- `devs_getting_chat_list:` — copy value from existing HI key `devs_getting_chatlist`
- `devs_chat_list_caption:` — copy value from existing HI key `devs_chatlist_caption`
- `devs_no_team_users:` — copy value from existing HI key `devs_no_team_members`
- `devs_no_users:` — copy value from existing HI key `devs_no_users_in_category`
- `greetings_join_request_approve_btn:` — copy value from existing HI key `greetings_join_request_approve_button`
- `greetings_join_request_decline_btn:` — copy value from existing HI key `greetings_join_request_decline_button`
- `greetings_join_request_ban_btn:` — copy value from existing HI key `greetings_join_request_ban_button`
- `bans_cannot_identify_user: "उत्तर दिए गए संदेश से उपयोगकर्ता की पहचान नहीं हो पा रही है।"` (translate from EN)
- `captcha_internal_error: "कैप्चा सेटिंग्स अपडेट करते समय एक आंतरिक त्रुटि हुई। कृपया पुनः प्रयास करें।"` (translate from EN)
- `reports_cannot_report_channel: "आप किसी चैनल पोस्ट की रिपोर्ट नहीं कर सकते।"` (translate from EN)

REMOVE these 7 old keys from HI:
- `devs_getting_chatlist`
- `devs_chatlist_caption`
- `devs_no_team_members`
- `devs_no_users_in_category`
- `greetings_join_request_approve_button`
- `greetings_join_request_decline_button`
- `greetings_join_request_ban_button`

HI target: 835 + 10 - 7 = 838 keys

**After all edits, validate each file parses cleanly:**
```bash
python3 -c "import yaml; yaml.safe_load(open('locales/es.yml')); print('ES OK')"
python3 -c "import yaml; yaml.safe_load(open('locales/fr.yml')); print('FR OK')"
python3 -c "import yaml; yaml.safe_load(open('locales/hi.yml')); print('HI OK')"
```

**IMPORTANT:** When copying values from block-scalar keys in FR/HI (multi-line YAML), preserve the exact indentation. Use `python3 -c "import yaml; d=yaml.safe_load(open('locales/fr.yml')); print(repr(d.get('devs_getting_chatlist')))"` to extract the actual string value if the raw YAML is ambiguous.
  </action>
  <verify>
    <automated>python3 -c "
import yaml
for locale in ['es', 'fr', 'hi']:
    d = yaml.safe_load(open(f'locales/{locale}.yml'))
    assert len(d) == 838, f'{locale}: expected 838 keys, got {len(d)}'
    for k in ['bans_cannot_identify_user','captcha_internal_error','devs_chat_list_caption','devs_getting_chat_list','devs_no_team_users','devs_no_users','greetings_join_request_approve_btn','greetings_join_request_ban_btn','greetings_join_request_decline_btn','reports_cannot_report_channel']:
        assert k in d, f'{locale}: missing {k}'
    for k in ['devs_getting_chatlist','devs_chatlist_caption','devs_no_team_members','devs_no_users_in_category','greetings_join_request_approve_button','greetings_join_request_decline_button','greetings_join_request_ban_button']:
        assert k not in d, f'{locale}: old key still present: {k}'
print('All 3 locales: 838 keys, all new keys present, all old keys removed')
# ES-specific orphan check
es = yaml.safe_load(open('locales/es.yml'))
for k in ['misc_translate_need_text','misc_translate_no_text','misc_translate_provide_text']:
    assert k not in es, f'ES orphan still present: {k}'
print('ES: all misc_translate orphans removed')
"</automated>
  </verify>
  <done>
    - ES has 838 keys with zero orphans (7 ES-only orphans removed, 3 old greetings removed, 6 new keys added)
    - FR has 838 keys with all production keys present (10 added, 7 old removed)
    - HI has 838 keys with all production keys present (10 added, 7 old removed)
    - All YAML files parse cleanly
  </done>
</task>

<task type="auto">
  <name>Task 2: Run make check-translations and verify clean exit</name>
  <files></files>
  <action>
Run the full check-translations validation to confirm all fixes are correct:

```bash
make check-translations
```

This must exit 0 with zero missing translations across all four locales.

If it does NOT exit 0, analyze the output:
- If test fixture keys appear: plan 03-01 task 1 was not applied correctly — check the _test.go exclusion
- If production keys are missing: check that the exact key names match what code calls (underscore positions, btn vs button)
- If orphan detection is reported: check-translations currently does not check for orphans, so this is not a concern

Also run `make test` to ensure the Go test suite still passes:

```bash
make test
```

Both commands must succeed.
  </action>
  <verify>
    <automated>make check-translations && echo "CHECK-TRANSLATIONS: PASS" || echo "CHECK-TRANSLATIONS: FAIL"</automated>
  </verify>
  <done>
    - `make check-translations` exits 0 with zero missing translations
    - `make test` passes (no regressions)
    - Phase 3 success criterion #5 is met: all four locales pass clean
  </done>
</task>

</tasks>

<verification>
1. `python3 -c "import yaml; [print(f'{l}: {len(yaml.safe_load(open(f\"locales/{l}.yml\")))} keys') for l in ['en','es','fr','hi']]"` — all four show 838 keys
2. `make check-translations` — exits 0, zero missing translations
3. `make test` — all Go tests pass
</verification>

<success_criteria>
- All four locale files have 838 keys each
- ES has zero orphan keys (no keys absent from EN)
- FR and HI have all production keys EN has
- `make check-translations` exits 0 with clean output
- `make test` passes without regressions
</success_criteria>

<output>
After completion, create `.planning/phases/03-locale-and-i18n-fixes/03-02-SUMMARY.md`
</output>
