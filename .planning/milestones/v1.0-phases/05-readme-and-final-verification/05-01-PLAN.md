---
phase: 05-readme-and-final-verification
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified:
  - scripts/generate_docs/parsers.go
  - scripts/generate_docs/parsers_test.go
  - docs/src/content/docs/api-reference/environment.md
  - docs/src/content/docs/api-reference/database-schema.md
  - docs/src/content/docs/api-reference/commands.md
  - docs/src/content/docs/api-reference/callbacks.md
  - docs/src/content/docs/api-reference/lock-types.md
  - docs/src/content/docs/api-reference/permissions.md
autonomous: true
requirements: [VRFY-04]

must_haves:
  truths:
    - "camelToScreamingSnake('DatabaseURL') returns 'DATABASE_URL' (not 'DATABASE_U_R_L')"
    - "camelToScreamingSnake('DBMaxIdleConns') returns 'DB_MAX_IDLE_CONNS' (not 'D_B_MAX_IDLE_CONNS')"
    - "camelToScreamingSnake('BatchRequestTimeoutMS') returns 'BATCH_REQUEST_TIMEOUT_MS' (not 'BATCH_REQUEST_TIMEOUT_M_S')"
    - "camelToScreamingSnake('EnableHTTPConnectionPooling') returns 'ENABLE_HTTP_CONNECTION_POOLING'"
    - "make generate-docs produces api-reference/environment.md with correct env var names matching sample.env"
  artifacts:
    - scripts/generate_docs/parsers_test.go (with TestCamelToScreamingSnake)
    - scripts/generate_docs/parsers.go (with fixed camelToScreamingSnake)
  key_links:
    - "camelToScreamingSnake in parsers.go is called by environment variable documentation generator"
    - "api-reference/environment.md is generated by make generate-docs using config.go field names"
---

<objective>
Fix the `camelToScreamingSnake` bug in `scripts/generate_docs/parsers.go` that mangles acronyms in environment variable names, then regenerate the api-reference documentation files.

Purpose: The generate-docs script produces incorrect env var names like `DATABASE_U_R_L` and `D_B_MAX_IDLE_CONNS` because each consecutive uppercase letter in acronyms triggers a separate underscore. This makes the generated `api-reference/environment.md` diverge from the manually corrected version.

Output: Fixed parsers.go, unit tests for the function, regenerated api-reference/*.md files with correct env var names.
</objective>

<execution_context>
@/Users/divkix/.claude/get-shit-done/workflows/execute-plan.md
@/Users/divkix/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-readme-and-final-verification/05-RESEARCH.md

Key source files:
@scripts/generate_docs/parsers.go (lines 699-713: broken camelToScreamingSnake)
@scripts/generate_docs/parsers_test.go (existing test file, add new test function)

<interfaces>
From scripts/generate_docs/parsers.go (line 699-713):
```go
// CURRENT (broken) — each uppercase letter gets a preceding underscore
func camelToScreamingSnake(s string) string {
    var result strings.Builder
    for i, r := range s {
        if r >= 'A' && r <= 'Z' {
            if i > 0 {
                result.WriteRune('_')
            }
            result.WriteRune(r)
        } else {
            result.WriteRune(r - 32) // Convert to uppercase
        }
    }
    return result.String()
}
```

From scripts/generate_docs/parsers_test.go:
```go
package main
// File already exists with TestParseCommands_MultiCommand
// New TestCamelToScreamingSnake function should be appended
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: RED — Write failing test for camelToScreamingSnake</name>
  <files>scripts/generate_docs/parsers_test.go</files>
  <action>
Append a `TestCamelToScreamingSnake` function to `scripts/generate_docs/parsers_test.go`. Use table-driven tests with these cases:

| Input | Expected Output |
|-------|----------------|
| `"BotToken"` | `"BOT_TOKEN"` |
| `"DatabaseURL"` | `"DATABASE_URL"` |
| `"DBMaxIdleConns"` | `"DB_MAX_IDLE_CONNS"` |
| `"DBConnMaxIdleTimeMin"` | `"DB_CONN_MAX_IDLE_TIME_MIN"` |
| `"BatchRequestTimeoutMS"` | `"BATCH_REQUEST_TIMEOUT_MS"` |
| `"EnableHTTPConnectionPooling"` | `"ENABLE_HTTP_CONNECTION_POOLING"` |
| `"HTTPPort"` | `"HTTP_PORT"` |
| `"EnablePPROF"` | `"ENABLE_PPROF"` |
| `"RedisAddress"` | `"REDIS_ADDRESS"` |
| `"UseWebhooks"` | `"USE_WEBHOOKS"` |

Run the test and confirm it FAILS against the current broken implementation (the acronym cases like `DatabaseURL` should produce wrong output like `DATABASE_U_R_L`).

Do NOT modify parsers.go yet.
  </action>
  <verify>
    <automated>cd /Users/divkix/GitHub/Alita_Robot/scripts/generate_docs && go test -run TestCamelToScreamingSnake -v 2>&1 | grep -E "FAIL|PASS"</automated>
    Expected: FAIL (red phase — tests must fail against broken implementation)
  </verify>
  <done>TestCamelToScreamingSnake exists with 10 test cases. Running against current code produces failures for acronym-containing inputs (DatabaseURL, DBMaxIdleConns, etc.).</done>
</task>

<task type="auto">
  <name>Task 2: GREEN — Fix camelToScreamingSnake to handle acronym sequences</name>
  <files>scripts/generate_docs/parsers.go</files>
  <action>
Replace the `camelToScreamingSnake` function at line ~699 in `scripts/generate_docs/parsers.go` with the correct implementation that handles consecutive uppercase letters as acronym groups:

```go
func camelToScreamingSnake(s string) string {
    var result strings.Builder
    runes := []rune(s)
    for i, r := range runes {
        isUpper := r >= 'A' && r <= 'Z'
        if isUpper && i > 0 {
            prevIsLower := runes[i-1] >= 'a' && runes[i-1] <= 'z'
            nextIsLower := i+1 < len(runes) && runes[i+1] >= 'a' && runes[i+1] <= 'z'
            if prevIsLower || nextIsLower {
                result.WriteRune('_')
            }
        }
        if r >= 'a' && r <= 'z' {
            result.WriteRune(r - 32)
        } else {
            result.WriteRune(r)
        }
    }
    return result.String()
}
```

The algorithm: insert `_` before an uppercase letter ONLY when transitioning from lowercase-to-uppercase OR when the next character after this uppercase is lowercase (end of acronym). This keeps consecutive uppercase sequences like `URL`, `DB`, `HTTP`, `PPROF` intact.

Run the test suite and confirm all 10 cases pass.
  </action>
  <verify>
    <automated>cd /Users/divkix/GitHub/Alita_Robot/scripts/generate_docs && go test -run TestCamelToScreamingSnake -v</automated>
    Expected: PASS — all 10 test cases green
  </verify>
  <done>All TestCamelToScreamingSnake cases pass. `DatabaseURL` produces `DATABASE_URL`, `DBMaxIdleConns` produces `DB_MAX_IDLE_CONNS`, etc.</done>
</task>

<task type="auto">
  <name>Task 3: Regenerate api-reference docs with fixed script</name>
  <files>
    docs/src/content/docs/api-reference/environment.md
    docs/src/content/docs/api-reference/database-schema.md
    docs/src/content/docs/api-reference/commands.md
    docs/src/content/docs/api-reference/callbacks.md
    docs/src/content/docs/api-reference/lock-types.md
    docs/src/content/docs/api-reference/permissions.md
  </files>
  <action>
Run `make generate-docs` from the repo root. This regenerates all docs targets.

After generation, inspect the `api-reference/environment.md` specifically — confirm that env var names now match `sample.env` (e.g., `DATABASE_URL` not `DATABASE_U_R_L`, `DB_MAX_IDLE_CONNS` not `D_B_MAX_IDLE_CONNS`).

**IMPORTANT:** The generator also overwrites `commands/{module}/index.md` files with auto-generated content that may be lower quality than the hand-edited committed versions. After running generate-docs:
1. Stage ONLY the `api-reference/*.md` files and the `parsers.go` + `parsers_test.go` changes
2. For `commands/` module pages, run `git diff docs/src/content/docs/commands/` to inspect changes. If the generator reverted hand-edited descriptions back to "No description available" or generic text, restore the committed versions with `git checkout -- docs/src/content/docs/commands/`
3. Delete `docs/src/content/docs/commands/index.md` if it exists — it is shadowed by `commands/index.mdx` and serves no purpose

The committed hand-edited `commands/` module pages are the canonical source. Only `api-reference/*.md` files should be updated from the generator output.
  </action>
  <verify>
    <automated>cd /Users/divkix/GitHub/Alita_Robot && make generate-docs && grep -c "DATABASE_U_R_L\|D_B_MAX\|TIMEOUT_M_S" docs/src/content/docs/api-reference/environment.md | grep "^0$"</automated>
    Expected: grep returns 0 (no mangled env var names in the generated output)
  </verify>
  <done>api-reference/environment.md contains correct env var names (DATABASE_URL, DB_MAX_IDLE_CONNS, BATCH_REQUEST_TIMEOUT_MS). commands/ module pages are preserved as hand-edited. The dead commands/index.md file is removed if present.</done>
</task>

</tasks>

<verification>
1. `cd scripts/generate_docs && go test ./... -v` — all tests pass including TestCamelToScreamingSnake
2. `make generate-docs` completes without errors
3. `grep "DATABASE_U_R_L\|D_B_MAX\|TIMEOUT_M_S\|HTTP_P_O_R_T" docs/src/content/docs/api-reference/environment.md` returns no matches (zero mangled names)
4. `git diff --stat docs/src/content/docs/commands/` shows no unintended changes to hand-edited module pages
</verification>

<success_criteria>
- TestCamelToScreamingSnake passes with all 10 test cases
- camelToScreamingSnake correctly handles all acronym patterns (URL, DB, HTTP, MS, PPROF)
- api-reference/environment.md has correct env var names after regeneration
- commands/ module pages are not regressed by the regeneration
</success_criteria>

<output>
After completion, create `.planning/phases/05-readme-and-final-verification/05-01-SUMMARY.md`
</output>
