---
phase: 06-gap-closure-restore-api-reference-and-housekeeping
plan: 02
type: execute
wave: 2
depends_on: [06-01]
files_modified:
  - scripts/generate_docs/generators.go
  - .planning/INVENTORY.json
  - .planning/INVENTORY.md
  - .planning/phases/02-api-reference-and-command-documentation/02-01-SUMMARY.md
  - .planning/phases/02-api-reference-and-command-documentation/02-02-SUMMARY.md
  - .planning/phases/02-api-reference-and-command-documentation/02-03-SUMMARY.md
  - .planning/ROADMAP.md
  - .planning/REQUIREMENTS.md
  - .planning/STATE.md
autonomous: true
requirements:
  - DOCS-02
  - DOCS-03
  - DOCS-04
  - DOCS-05
  - DOCS-07

must_haves:
  truths:
    - "`make generate-docs` does not overwrite sentinel-protected files — commands.md and callbacks.md are preserved after a generator run"
    - "INVENTORY.json shows `has_docs_directory: true` for devs, help, and users modules"
    - "INVENTORY.md 'Modules Without Documentation' section no longer lists devs, help, or users"
    - "Phase 2 SUMMARY.md files have `requirements_completed` arrays in frontmatter"
    - "ROADMAP.md Phase 6 plans list and progress table are accurate"
    - "REQUIREMENTS.md traceability table shows DOCS-02/03/04/05/07 as Complete"
    - "STATE.md reflects Phase 6 completion status"
  artifacts:
    - path: "scripts/generate_docs/generators.go"
      provides: "Sentinel skip mechanism for manually maintained files"
      contains: "MANUALLY MAINTAINED"
    - path: ".planning/INVENTORY.json"
      provides: "Updated inventory with correct has_docs_directory values"
      contains: "has_docs_directory"
    - path: ".planning/ROADMAP.md"
      provides: "Updated Phase 6 plan list and progress table"
      contains: "06-01-PLAN.md"
  key_links:
    - from: "scripts/generate_docs/generators.go"
      to: "docs/src/content/docs/api-reference/commands.md"
      via: "Sentinel check before writing prevents overwrite"
      pattern: "skipIfManuallyMaintained"
    - from: "scripts/generate_docs/generators.go"
      to: "docs/src/content/docs/api-reference/callbacks.md"
      via: "Sentinel check before writing prevents overwrite"
      pattern: "skipIfManuallyMaintained"
---

<objective>
Harden the docs generator against future overwrites of manually maintained files, update the stale INVENTORY to reflect Phase 2's new docs directories, and fix all metadata tracking files to reflect Phase 6 completion.

Purpose: Without generator hardening, any future `make generate-docs` run will silently revert the restored api-reference files. Without inventory update, the canonical inventory falsely claims devs/help/users have no docs. Without metadata fixes, the planning/tracking infrastructure has stale progress data and missing requirement completion records.

Output: Generator with sentinel skip mechanism, updated INVENTORY.json/MD, and corrected ROADMAP/REQUIREMENTS/STATE/SUMMARY metadata files.
</objective>

<execution_context>
@/Users/divkix/.claude/get-shit-done/workflows/execute-plan.md
@/Users/divkix/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-gap-closure-restore-api-reference-and-housekeeping/06-RESEARCH.md
@.planning/phases/06-gap-closure-restore-api-reference-and-housekeeping/06-01-SUMMARY.md

<interfaces>
<!-- Sentinel constant and skip function to add to generators.go -->

```go
const manualMaintenanceSentinel = "<!-- MANUALLY MAINTAINED: do not regenerate -->"

func skipIfManuallyMaintained(filePath string) bool {
    data, err := os.ReadFile(filePath)
    if err != nil {
        return false // File doesn't exist, proceed with generation
    }
    checkLen := 512
    if len(data) < checkLen {
        checkLen = len(data)
    }
    return strings.Contains(string(data[:checkLen]), manualMaintenanceSentinel)
}
```

<!-- Integration points in generators.go -->

generateCommandReference() at line ~150:
  - After computing refFile path, BEFORE building content
  - Must handle both DryRun and normal write paths

generateCallbacksReference() at line ~922:
  - After computing filePath, BEFORE building content
  - Must handle both DryRun and normal write paths

<!-- Guard pattern (same for both functions): -->
```go
if skipIfManuallyMaintained(refFile) {
    log.Infof("Skipped: %s (manually maintained)", filepath.Base(refFile))
    return nil
}
```

<!-- INVENTORY update -->
Run `make inventory` from project root — NOT manual JSON editing.
The Makefile target runs: `cd scripts/generate_docs && go run . -inventory`
This writes both .planning/INVENTORY.json and .planning/INVENTORY.md from filesystem state.

<!-- Phase 2 SUMMARY frontmatter additions -->
02-01-SUMMARY.md: add `requirements_completed: [DOCS-06]`
02-02-SUMMARY.md: add `requirements_completed: [DOCS-02, DOCS-03, DOCS-04, DOCS-05, DOCS-07]`
02-03-SUMMARY.md: add `requirements_completed: [DOCS-01, DOCS-03]`
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add sentinel skip mechanism to generators.go</name>
  <files>scripts/generate_docs/generators.go</files>
  <action>
Add the sentinel skip mechanism to `scripts/generate_docs/generators.go`. This prevents `make generate-docs` from overwriting files that contain the sentinel comment `<!-- MANUALLY MAINTAINED: do not regenerate -->`.

**Step 1: Add the sentinel constant and skip function.**

Near the top of generators.go (after the import block, before the first function), add:

```go
// manualMaintenanceSentinel marks files that should not be overwritten by the generator.
// Files containing this sentinel in their first 512 bytes are skipped during generation.
const manualMaintenanceSentinel = "<!-- MANUALLY MAINTAINED: do not regenerate -->"

// skipIfManuallyMaintained checks if a file has the sentinel comment
// indicating it should not be overwritten by the generator.
func skipIfManuallyMaintained(filePath string) bool {
    data, err := os.ReadFile(filePath)
    if err != nil {
        return false // File doesn't exist, proceed with generation
    }
    checkLen := 512
    if len(data) < checkLen {
        checkLen = len(data)
    }
    return strings.Contains(string(data[:checkLen]), manualMaintenanceSentinel)
}
```

**Step 2: Add sentinel guard to `generateCommandReference()`.**

In `generateCommandReference()` (line ~150), add the guard immediately after computing `refFile` and before building content. The guard must be BEFORE the `log.Debug("Generating command reference")` line:

```go
func generateCommandReference(modules []Module, outputPath string) error {
    refDir := filepath.Join(outputPath, "api-reference")
    refFile := filepath.Join(refDir, "commands.md")

    if skipIfManuallyMaintained(refFile) {
        log.Infof("Skipped: %s (manually maintained)", filepath.Base(refFile))
        return nil
    }

    log.Debug("Generating command reference")
    // ... rest of function unchanged
}
```

The early return means neither DryRun nor normal write paths execute — the entire function is skipped. This avoids the pitfall of only guarding the write block while DryRun still logs "Would write".

**Step 3: Add sentinel guard to `generateCallbacksReference()`.**

In `generateCallbacksReference()` (line ~922), add the same guard:

```go
func generateCallbacksReference(callbacks []Callback, outputPath string) error {
    filePath := filepath.Join(outputPath, "api-reference", "callbacks.md")

    if skipIfManuallyMaintained(filePath) {
        log.Infof("Skipped: %s (manually maintained)", filepath.Base(filePath))
        return nil
    }

    log.Debug("Generating callbacks reference")
    // ... rest of function unchanged
}
```

**Verification after implementation:** Run `make generate-docs` and confirm the two sentinel-protected files are skipped in output. Then verify the files still contain the restored content (grep for "namespace|v1" in callbacks.md and "Permission" in commands.md).
  </action>
  <verify>
    <automated>cd /Users/divkix/GitHub/Alita_Robot && grep -q "manualMaintenanceSentinel" scripts/generate_docs/generators.go && grep -q "skipIfManuallyMaintained" scripts/generate_docs/generators.go && make generate-docs 2>&1 | grep -q "manually maintained" && grep -q "Permission" docs/src/content/docs/api-reference/commands.md && grep -q "namespace|v1" docs/src/content/docs/api-reference/callbacks.md && echo "PASS"</automated>
  </verify>
  <done>generators.go contains sentinel skip mechanism. Both generateCommandReference() and generateCallbacksReference() have early-return guards. Running `make generate-docs` skips sentinel-protected files (logged as "manually maintained") and does NOT overwrite the restored content. commands.md still has Permission column. callbacks.md still has versioned codec format.</done>
</task>

<task type="auto">
  <name>Task 2: Update INVENTORY via make inventory and fix metadata files</name>
  <files>.planning/INVENTORY.json, .planning/INVENTORY.md, .planning/phases/02-api-reference-and-command-documentation/02-01-SUMMARY.md, .planning/phases/02-api-reference-and-command-documentation/02-02-SUMMARY.md, .planning/phases/02-api-reference-and-command-documentation/02-03-SUMMARY.md, .planning/ROADMAP.md, .planning/REQUIREMENTS.md, .planning/STATE.md</files>
  <action>
Update the stale inventory and fix all metadata tracking files.

**Step 1: Regenerate INVENTORY.**

Run `make inventory` from project root. This will regenerate both `.planning/INVENTORY.json` and `.planning/INVENTORY.md` from current filesystem state. After running, verify that `devs`, `help`, and `users` now show `has_docs_directory: true`.

Do NOT manually edit INVENTORY.json — use `make inventory` exclusively.

Verification command after running:
```bash
python3 -c "import json; d=json.load(open('.planning/INVENTORY.json')); [print(m['module'], m['has_docs_directory']) for m in d if m['module'] in ['devs','help','users']]"
```
Expected output: all three show `True`.

**Step 2: Add requirements_completed to Phase 2 SUMMARY files.**

Edit the frontmatter of each file (add the field after the `completed:` line, before `---`):

`02-01-SUMMARY.md`:
```yaml
requirements_completed: [DOCS-06]
```

`02-02-SUMMARY.md`:
```yaml
requirements_completed: [DOCS-02, DOCS-03, DOCS-04, DOCS-05, DOCS-07]
```

`02-03-SUMMARY.md`:
```yaml
requirements_completed: [DOCS-01, DOCS-03]
```

**Step 3: Update ROADMAP.md.**

Under Phase 6 details, update the "Plans:" section to list the actual plans:
```markdown
Plans:
- [x] 06-01-PLAN.md — Restore api-reference/commands.md and callbacks.md with sentinels [Wave 1, DOCS-02, DOCS-03, DOCS-04, DOCS-05, DOCS-07]
- [x] 06-02-PLAN.md — Harden generator + INVENTORY update + metadata housekeeping [Wave 2, DOCS-02, DOCS-03, DOCS-04, DOCS-05, DOCS-07]
```

Update the progress table Phase 6 row:
```markdown
| 6. Gap Closure — Restore api-reference and Housekeeping | 2/2 | Complete | 2026-02-28 |
```

**Step 4: Update REQUIREMENTS.md traceability table.**

Change DOCS-02, DOCS-03, DOCS-04, DOCS-05, DOCS-07 status from `Pending` to `Complete`:
```
| DOCS-02 | Phase 6 | Complete |
| DOCS-03 | Phase 6 | Complete |
| DOCS-04 | Phase 6 | Complete |
| DOCS-05 | Phase 6 | Complete |
| DOCS-07 | Phase 6 | Complete |
```

**Step 5: Update STATE.md.**

Update to reflect Phase 6 completion:
- `status: complete`
- `total_phases: 6`, `completed_phases: 6`
- `total_plans: 16`, `completed_plans: 16`
- Current Position: Phase 6 of 6 — COMPLETE
- Progress bar: 100%
- Last activity: Phase 6 complete
  </action>
  <verify>
    <automated>cd /Users/divkix/GitHub/Alita_Robot && python3 -c "import json; d=json.load(open('.planning/INVENTORY.json')); assert all(next(m for m in d if m['module']==mod)['has_docs_directory'] for mod in ['devs','help','users']), 'FAIL'; print('INVENTORY PASS')" && grep -q "requirements_completed" .planning/phases/02-api-reference-and-command-documentation/02-02-SUMMARY.md && grep "DOCS-02" .planning/REQUIREMENTS.md | grep -q "Complete" && grep "06-01-PLAN.md" .planning/ROADMAP.md | grep -q "Wave 1" && echo "ALL PASS"</automated>
  </verify>
  <done>INVENTORY.json/MD updated via make inventory — devs/help/users show has_docs_directory=true. Phase 2 SUMMARY frontmatters have requirements_completed arrays. ROADMAP.md Phase 6 plans list and progress table accurate. REQUIREMENTS.md shows all 5 requirements as Complete. STATE.md reflects Phase 6 completion at 100%.</done>
</task>

</tasks>

<verification>
1. `grep -q "skipIfManuallyMaintained" scripts/generate_docs/generators.go && echo PASS` — sentinel skip function exists
2. `make generate-docs 2>&1 | grep -c "manually maintained"` — returns 2 (both files skipped)
3. `grep -q "Permission" docs/src/content/docs/api-reference/commands.md && echo PASS` — restored content survived generator run
4. `grep -q "namespace|v1" docs/src/content/docs/api-reference/callbacks.md && echo PASS` — restored content survived generator run
5. `python3 -c "import json; d=json.load(open('.planning/INVENTORY.json')); [print(m['module'],m['has_docs_directory']) for m in d if m['module'] in ['devs','help','users']]"` — all True
6. `grep "DOCS-02" .planning/REQUIREMENTS.md` — shows Complete
7. `cd /Users/divkix/GitHub/Alita_Robot/docs && bun run build 2>&1 | tail -5` — build passes
</verification>

<success_criteria>
- generators.go contains skipIfManuallyMaintained() function and sentinel constant
- Both generateCommandReference() and generateCallbacksReference() have sentinel guards
- Running `make generate-docs` skips the two protected files and logs "manually maintained"
- Post-generator-run, commands.md and callbacks.md retain restored content
- INVENTORY.json shows has_docs_directory=true for devs, help, users
- Phase 2 SUMMARY files have requirements_completed frontmatter
- ROADMAP.md has Phase 6 plans listed and progress table shows 2/2 Complete
- REQUIREMENTS.md shows DOCS-02/03/04/05/07 as Complete
- STATE.md shows 6/6 phases complete, 100% progress
- Docs site builds clean
</success_criteria>

<output>
After completion, create `.planning/phases/06-gap-closure-restore-api-reference-and-housekeeping/06-02-SUMMARY.md`
</output>
