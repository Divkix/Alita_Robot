---
phase: 06-gap-closure-restore-api-reference-and-housekeeping
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/src/content/docs/api-reference/commands.md
  - docs/src/content/docs/api-reference/callbacks.md
autonomous: true
requirements:
  - DOCS-02
  - DOCS-03
  - DOCS-04
  - DOCS-05
  - DOCS-07

must_haves:
  truths:
    - "`api-reference/commands.md` contains all 142 commands from the canonical inventory including the 13 previously missing commands (start, help, donate, about, stats, addsudo, adddev, remsudo, remdev, chatinfo, chatlist, leavechat, teamusers)"
    - "The commands table uses the 5-column structure: Command | Description | Permission | Disableable | Aliases"
    - "All 8 MultiCommand aliases have their own rows with 'Alias of /primary' notation in both module tables and alphabetical index"
    - "Exactly 17 commands are marked as disableable (matching canonical inventory count)"
    - "Permission column values match actual handler guards: Everyone, Admin, Owner, Dev/Owner, Team, User/Admin"
    - "`callbacks.md` documents the versioned codec format (`namespace|v1|url-encoded-fields`) with encode/decode Go code example"
    - "The old dot-notation explanation in callbacks.md is replaced with versioned format, plus a backward-compatibility note"
    - "Both files contain the sentinel comment `<!-- MANUALLY MAINTAINED: do not regenerate -->` after frontmatter to protect against future generator overwrites"
  artifacts:
    - path: "docs/src/content/docs/api-reference/commands.md"
      provides: "Complete command reference with 142 commands, 5-column format, aliases, permissions, sentinel"
      contains: "Alias of"
    - path: "docs/src/content/docs/api-reference/callbacks.md"
      provides: "Updated callback reference with versioned codec format and sentinel"
      contains: "namespace|v1|url-encoded-fields"
  key_links:
    - from: "docs/src/content/docs/api-reference/commands.md"
      to: ".planning/INVENTORY.json"
      via: "All command data sourced from canonical inventory"
      pattern: "142"
    - from: "docs/src/content/docs/api-reference/callbacks.md"
      to: "alita/utils/callbackcodec/callbackcodec.go"
      via: "Codec format specification matches actual implementation"
      pattern: "namespace|v1"
---

<objective>
Restore the api-reference/commands.md and api-reference/callbacks.md files that were overwritten by `make generate-docs` during Phase 5, replacing their auto-generated content with the manually verified Phase 2 content. Add sentinel comments to both files to protect against future regeneration.

Purpose: Phase 5's `make generate-docs` run unconditionally overwrote both files, reverting the manually verified 5-column format (with Permission column, alias notation, 142 commands) to the auto-generated 4-column format (129 commands, no Permission column). This broke DOCS-02/03/04/05/07 which were previously satisfied. The sentinel comment ensures this regression cannot recur.

Output: Restored `commands.md` with 142 commands in 5-column format and restored `callbacks.md` with versioned codec documentation. Both files contain sentinel comments after frontmatter.
</objective>

<execution_context>
@/Users/divkix/.claude/get-shit-done/workflows/execute-plan.md
@/Users/divkix/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-gap-closure-restore-api-reference-and-housekeeping/06-RESEARCH.md
@.planning/phases/02-api-reference-and-command-documentation/02-02-PLAN.md
@.planning/INVENTORY.json

<interfaces>
<!-- SENTINEL COMMENT ‚Äî must be placed on the FIRST line after frontmatter closing `---`, BEFORE any content -->
<!-- This is an HTML comment invisible to all markdown renderers including Starlight/Astro -->

Sentinel value:
<!-- MANUALLY MAINTAINED: do not regenerate -->

<!-- 5-column table format for commands.md -->
| Command | Description | Permission | Disableable | Aliases |
|---------|-------------|------------|-------------|---------|

<!-- 4-column alphabetical index format for commands.md -->
| Command | Module | Description | Permission |
|---------|--------|-------------|------------|

<!-- Permission level values (verified from source code) -->
"Everyone" ‚Äî no permission guard in handler
"Admin" ‚Äî RequireUserAdmin() or RequireUserOwner() guard
"Owner" ‚Äî user.Id != config.AppConfig.OwnerId guard (bot owner)
"Dev/Owner" ‚Äî user.Id != config.AppConfig.OwnerId && !memStatus.Dev guard
"Team" ‚Äî FindInInt64Slice(teamint64Slice, user.Id) guard
"User/Admin" ‚Äî asymmetric: any user in private, admin in groups (language module only)

<!-- Alias notation for MultiCommand pairs ‚Äî alias row gets "Alias of /primary" as Description -->
| `/rmallbl` | Alias of `/remallbl` | Admin | ‚ùå | ‚Äî |

<!-- MultiCommand pairs (primary listed first) -->
blacklists: remallbl ‚Üî rmallbl     (primary: remallbl)
formatting: markdownhelp ‚Üî formatting (primary: markdownhelp)
notes: privnote ‚Üî privatenotes  (primary: privnote)
rules: resetrules ‚Üî clearrules  (primary: resetrules)

<!-- 13 missing commands to ADD -->

Help module (4 commands, all "Everyone" permission):
- start ‚Üí Show welcome message with navigation menu
- help ‚Üí Show help menu with module list
- donate ‚Üí Show donation information
- about ‚Üí Show bot information and links

Devs module (9 commands, mixed permissions):
- stats ‚Üí Display bot statistics and system info (Dev/Owner)
- addsudo ‚Üí Grant sudo permissions to a user (Owner)
- adddev ‚Üí Grant developer permissions to a user (Owner)
- remsudo ‚Üí Revoke sudo permissions from a user (Owner)
- remdev ‚Üí Revoke developer permissions from a user (Owner)
- teamusers ‚Üí List all team members (Team)
- chatinfo ‚Üí Display detailed information about a chat (Dev/Owner)
- chatlist ‚Üí Generate and send a list of all active chats (Dev/Owner)
- leavechat ‚Üí Force the bot to leave a specified chat (Dev/Owner)

<!-- 17 disableable commands -->
admin/adminlist, antiflood/flood, blacklists/blacklists, disabling/disabled,
filters/filters, locks/locks, locks/locktypes, misc/id, misc/info, misc/ping,
misc/stat, misc/tr, notes/get, notes/notes, reports/report, rules/rules, warns/warns

<!-- Permission column values for ALL existing modules (verified from source code in 02-02-PLAN.md) -->
Admin module: all Admin except /adminlist (Everyone)
Antiflood: all Admin
Bans: all Admin except /kickme (Everyone)
Blacklists: all Admin
Captcha: all Admin
Connections: /connect (Everyone), /disconnect (Everyone), /reconnect (Everyone), /connection (Everyone), /allowconnect (Admin)
Disabling: all Admin
Filters: all Admin except /filters (Everyone ‚Äî lists filters)
Formatting: all Everyone
Greetings: all Admin
Languages: User/Admin (asymmetric permission pattern)
Locks: all Admin
Misc: all Everyone
Mutes: all Admin
Notes: /save, /addnote (Admin), /clear, /rmnote, /clearall (Admin), /get, /notes, /saved (Everyone), /privnote, /privatenotes (Admin)
Pins: all Admin
Purges: all Admin
Reports: /report (Everyone), /reports (Admin)
Rules: /rules (Everyone), all others (Admin)
Warns: all Admin except /warns (Everyone) and /warnings (Everyone)

<!-- Callback codec format from alita/utils/callbackcodec/callbackcodec.go -->
Encode: namespace|v1|url-query-encoded-fields
Empty payload: namespace|v1|_
Max length: 64 bytes (Telegram limit)

Example encode/decode:
```go
data, err := callbackcodec.Encode("restrict", map[string]string{
    "a":   "ban",
    "uid": "123456789",
})
// ‚Üí "restrict|v1|a=ban&uid=123456789"

data, err := callbackcodec.Encode("helpq", map[string]string{})
// ‚Üí "helpq|v1|_"

decoded, err := callbackcodec.Decode("restrict|v1|a=ban&uid=123456789")
namespace := decoded.Namespace   // "restrict"
action, _ := decoded.Field("a")  // "ban"
uid, _ := decoded.Field("uid")   // "123456789"
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite api-reference/commands.md with 5-column format, all 142 commands, and sentinel</name>
  <files>docs/src/content/docs/api-reference/commands.md</files>
  <action>
Rewrite the entire `docs/src/content/docs/api-reference/commands.md` file. This is a full rewrite ‚Äî the column structure changes, 13 commands are added, and a sentinel comment is inserted.

**CRITICAL: Sentinel placement.** The FIRST line after the closing `---` of frontmatter MUST be:
```
<!-- MANUALLY MAINTAINED: do not regenerate -->
```
This HTML comment prevents future `make generate-docs` runs from overwriting the file (once the generator is hardened in 06-02). Place it on its own line, immediately after `---`, before the `#` heading.

**Frontmatter:** Keep existing frontmatter (title, description) unchanged.

**Header section ‚Äî update Overview counts:**
```markdown
## Overview

- **Total Modules**: 25 (24 user-facing + 1 internal)
- **Total Commands**: 142
```

**Commands by Module sections:**

Rewrite every module table with the 5-column format:
```markdown
| Command | Description | Permission | Disableable | Aliases |
```

For EACH module section:
1. Keep the existing emoji + module name heading (e.g., `### üëë Admin`)
2. Replace the 4-column table (Command|Handler|Disableable|Aliases) with 5-column table (Command|Description|Permission|Disableable|Aliases)
3. Fill in ALL "No description available" entries with terse functional descriptions (action-oriented verb form, under ~60 chars: "Ban a user" not "Bans a user")
4. Add the Permission column using the values from the `<interfaces>` section above
5. Verify Disableable column against the 17 disableable commands listed in interfaces

**New module sections to ADD (currently missing entirely):**

Add `### üîß Devs` section with all 9 commands:

| Command | Description | Permission | Disableable | Aliases |
|---------|-------------|------------|-------------|---------|
| `/addsudo` | Grant sudo permissions to a user | Owner | ‚ùå | ‚Äî |
| `/adddev` | Grant developer permissions to a user | Owner | ‚ùå | ‚Äî |
| `/chatinfo` | Display detailed information about a chat | Dev/Owner | ‚ùå | ‚Äî |
| `/chatlist` | Generate and send a list of all active chats | Dev/Owner | ‚ùå | ‚Äî |
| `/leavechat` | Force the bot to leave a specified chat | Dev/Owner | ‚ùå | ‚Äî |
| `/remdev` | Revoke developer permissions from a user | Owner | ‚ùå | ‚Äî |
| `/remsudo` | Revoke sudo permissions from a user | Owner | ‚ùå | ‚Äî |
| `/stats` | Display bot statistics and system info | Dev/Owner | ‚ùå | ‚Äî |
| `/teamusers` | List all team members | Team | ‚ùå | ‚Äî |

Add `### ‚ùì Help` section with all 4 commands:

| Command | Description | Permission | Disableable | Aliases |
|---------|-------------|------------|-------------|---------|
| `/about` | Show bot information and links | Everyone | ‚ùå | ‚Äî |
| `/donate` | Show donation information | Everyone | ‚ùå | ‚Äî |
| `/help` | Show help menu with module list | Everyone | ‚ùå | ‚Äî |
| `/start` | Show welcome message with navigation menu | Everyone | ‚ùå | ‚Äî |

**Alias rows in module tables:**

For each MultiCommand pair, BOTH commands get their own row. The alias gets "Alias of /primary" as its description:
- Blacklists: `/remallbl` is primary ‚Üí `/rmallbl` gets "Alias of `/remallbl`"
- Formatting: `/markdownhelp` is primary ‚Üí `/formatting` gets "Alias of `/markdownhelp`"
- Notes: `/privnote` is primary ‚Üí `/privatenotes` gets "Alias of `/privnote`"
- Rules: `/resetrules` is primary ‚Üí `/clearrules` gets "Alias of `/resetrules`"

Both primary and alias rows must have same Permission and Disableable values.

**Section ordering for module tables:**

Place modules in this order (matching index.mdx categories):
1. Administration: Admin
2. Moderation: Antiflood, Antispam (0 commands), Bans, Blacklists, Captcha, Locks, Mutes, Purges, Warns
3. Content Management: Filters, Formatting, Greetings, Notes, Rules
4. User Tools: Misc, Reports
5. Bot Management: Connections, Disabling, Help, Languages, Pins
6. Developer: Devs
7. Internal: Users (0 commands ‚Äî add note "No commands ‚Äî passive background tracker")

For Antispam and Users (0 commands), do NOT include an empty table. Add: "This module has no user-facing commands. See [module page](/commands/antispam/) for details." with correct path.

**Alphabetical Index update:**

Rewrite the Alphabetical Index section with the new column format:
```markdown
| Command | Module | Description | Permission |
```

Add all 13 missing commands and all alias rows in alphabetical order.

**Description normalization:**

While rewriting each module's table, normalize ALL descriptions to terse functional tone:
- "bans a user. (via handle, or reply)" ‚Üí "Ban a user"
- "kicks the user who issued the command." ‚Üí "Kick yourself from the group"
- "Gets the count of the total number of messages in the chat." ‚Üí "Show message count for the chat"
- "List the admins in the current chat." ‚Üí "List chat admins"
  </action>
  <verify>
    <automated>cd /Users/divkix/GitHub/Alita_Robot && grep -q "MANUALLY MAINTAINED" docs/src/content/docs/api-reference/commands.md && TABLE_ROWS=$(grep -c '^|' docs/src/content/docs/api-reference/commands.md) && [ "$TABLE_ROWS" -gt 140 ] && grep -q "/start" docs/src/content/docs/api-reference/commands.md && ALIAS_COUNT=$(grep -c "Alias of" docs/src/content/docs/api-reference/commands.md) && [ "$ALIAS_COUNT" -ge 4 ] && grep -q "Dev/Owner" docs/src/content/docs/api-reference/commands.md && grep -q "Permission" docs/src/content/docs/api-reference/commands.md && echo "PASS"</automated>
  </verify>
  <done>commands.md contains sentinel comment, all 142 commands in the 5-column format (Command|Description|Permission|Disableable|Aliases). All 13 previously missing commands are present. All 8 alias rows use "Alias of /primary" notation. Permission column matches handler guards. Exactly 17 commands marked disableable. All descriptions use terse functional tone. Total count shows 25 modules / 142 commands.</done>
</task>

<task type="auto">
  <name>Task 2: Rewrite api-reference/callbacks.md with versioned codec format and sentinel</name>
  <files>docs/src/content/docs/api-reference/callbacks.md</files>
  <action>
Update `docs/src/content/docs/api-reference/callbacks.md` to replace the old dot-notation format with the versioned codec format and add sentinel comment. Read the current file first.

**CRITICAL: Sentinel placement.** The FIRST line after the closing `---` of frontmatter MUST be:
```
<!-- MANUALLY MAINTAINED: do not regenerate -->
```

**Replace the "Callback Data Format" section** (currently says "Callbacks use a prefix-based routing system" with `{prefix}{data}` example).

Replace with:
```markdown
## Callback Data Format

Callbacks use a versioned codec with URL-encoded fields:

```
<namespace>|v1|<url-encoded-fields>
```

For example: `restrict|v1|a=ban&uid=123456789` routes to the `restrict` namespace handler.

When the payload has no fields, `_` is used as placeholder: `helpq|v1|_`.

**Maximum length**: 64 bytes (Telegram's `callback_data` limit).

### Backward Compatibility

Legacy dot-notation (`prefix.field1.field2`) is accepted by handlers for backward compatibility but is deprecated. All new callbacks use the versioned format.
```

**Replace the "Registering Callbacks" and "Handling Callbacks" code example sections** at the bottom of the file. The current examples use `callbackquery.Prefix("myprefix.")` and `strings.TrimPrefix(query.Data, "myprefix.")` which show old dot-notation. Replace BOTH sections with a single "Code Example" section:

```markdown
## Code Example

### Encoding and Decoding Callback Data

```go
// Encode callback data
data, err := callbackcodec.Encode("restrict", map[string]string{
    "a":   "ban",
    "uid": "123456789",
})
// ‚Üí "restrict|v1|a=ban&uid=123456789"

// Empty payload
data, err := callbackcodec.Encode("helpq", map[string]string{})
// ‚Üí "helpq|v1|_"

// Decode callback data
decoded, err := callbackcodec.Decode("restrict|v1|a=ban&uid=123456789")
namespace := decoded.Namespace  // "restrict"
action, _ := decoded.Field("a") // "ban"
uid, _ := decoded.Field("uid")  // "123456789"
```

### Registering a Callback Handler

```go
dispatcher.AddHandler(handlers.NewCallback(
    callbackquery.Prefix("restrict"),
    myModule.restrictHandler,
))
```
```

**Keep the "All Callbacks" table and "Callbacks by Module" sections unchanged** ‚Äî the callback list itself is still accurate. The Overview counts (21 callbacks, 14 modules) are also correct per canonical inventory.

**Do NOT change the individual callback handler/source entries** ‚Äî those document what exists, not how the codec works.
  </action>
  <verify>
    <automated>cd /Users/divkix/GitHub/Alita_Robot && grep -q "MANUALLY MAINTAINED" docs/src/content/docs/api-reference/callbacks.md && grep -q "namespace|v1|url-encoded-fields" docs/src/content/docs/api-reference/callbacks.md && grep -q "callbackcodec.Encode" docs/src/content/docs/api-reference/callbacks.md && grep -q "Backward Compatibility" docs/src/content/docs/api-reference/callbacks.md && echo "PASS"</automated>
  </verify>
  <done>callbacks.md contains sentinel comment. Documents versioned codec format with namespace|v1|url-encoded-fields specification. Encode/decode Go code example present. Backward compatibility note for legacy dot-notation included. Old `{prefix}{data}` format and dot-notation examples removed. Callback list table unchanged.</done>
</task>

</tasks>

<verification>
1. `grep -q "MANUALLY MAINTAINED" docs/src/content/docs/api-reference/commands.md && echo PASS` ‚Äî sentinel present in commands.md
2. `grep -q "MANUALLY MAINTAINED" docs/src/content/docs/api-reference/callbacks.md && echo PASS` ‚Äî sentinel present in callbacks.md
3. `grep -c "/start" docs/src/content/docs/api-reference/commands.md` ‚Äî returns 2+ (module table + alphabetical index)
4. `grep -c "Alias of" docs/src/content/docs/api-reference/commands.md` ‚Äî returns 4+ (one per alias pair)
5. `grep "142" docs/src/content/docs/api-reference/commands.md` ‚Äî total command count present
6. `grep "namespace|v1" docs/src/content/docs/api-reference/callbacks.md` ‚Äî versioned format documented
7. `grep -q "Permission" docs/src/content/docs/api-reference/commands.md && echo PASS` ‚Äî Permission column header present
8. `cd /Users/divkix/GitHub/Alita_Robot/docs && bun run build 2>&1 | tail -5` ‚Äî build passes with no errors
</verification>

<success_criteria>
- commands.md contains sentinel comment after frontmatter
- commands.md contains exactly 142 commands (verified against INVENTORY.json)
- All 13 previously missing commands are documented with correct descriptions and permissions
- Every MultiCommand alias has its own row with "Alias of /primary" notation
- Permission column accurately reflects handler guard patterns for every command
- Exactly 17 commands are marked disableable
- All descriptions use terse functional tone (action-oriented, under ~60 chars)
- callbacks.md contains sentinel comment after frontmatter
- callbacks.md documents versioned codec format with code example
- Old dot-notation format replaced with backward-compatibility note
- Docs site builds with no broken links
</success_criteria>

<output>
After completion, create `.planning/phases/06-gap-closure-restore-api-reference-and-housekeeping/06-01-SUMMARY.md`
</output>
